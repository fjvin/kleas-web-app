{% extends 'index.html' %}
{% load static %}

{% block content %}

<div class="row">
    <div class="col-sm">
        <div id="revenue">
            <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Revenue</h5>
                  <p class="card-text">â‚± {{ revenue }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm">
        <div id="sales">
            <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Total Sales</h5>
                  <p class="card-text">{{ total_sales }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm">
        <div id="expenses">
            <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Total Expenses</h5>
                  <p class="card-text">{{ total_expenses }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm">
        <!--Sales Trend Graph-->
        <div id="chart1"></div>         
    </div>
</div>
<div class="row">
    <div class="col-sm">
        <!--Sales by Category and Item-->
        <div id="chart2"></div>  
    </div>
</div>

<script src="{% static 'js/jquery-3.3.1.min.js' %}" type="text/javascript"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script type="text/javascript">
    var graph1 = {{ sales_graph|safe }};
    var graph2 = {{ category_item_graph|safe }};
    var config = {responsive: true};

    Plotly.newPlot("chart1", graph1, {}, config);
    Plotly.newPlot("chart2", graph2, {}, config);

    function resP(id){
        var d3 = Plotly.d3;
    
        var parent_width = $("#"+id).parent().width()
        var gd3 = d3.select(`div[id=${id}]`)
            .style({
                width: parent_width - 10,
                //'margin-right': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + 'vh',
                //'margin-top': (100 - HEIGHT_IN_PERCENT_OF_PARENT) / 2 + 'vh'
            });
        return gd3.node();
       }
    
       window.addEventListener('resize', function(){
        Plotly.Plots.resize( resP('chart1') );
       })

       window.addEventListener('resize', function(){
        Plotly.Plots.resize( resP('chart2') );
       })
    
</script>
{% endblock content %}